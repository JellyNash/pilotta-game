/* PlayerHand Flexbox Layout - Modern responsive approach */

/* 
 * Flexbox-based card layout system
 * Eliminates absolute positioning for better responsiveness
 * Prevents clipping issues with proper flex item management
 */

/* Variables from tokens.css */

/* Base wrapper */
.ph-flex-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
  z-index: inherit;
  padding: var(--space-xs); /* Add small padding to prevent edge clipping */
}

/* Flex container for cards */
.ph-flex-container {
  display: flex;
flex-flow: row nowrap; /* Keep cards in single row */
gap: var(--ph-card-gap, var(--card-gap));
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  max-width: 100%;
  overflow: visible;
  padding: var(--ph-container-padding, 1rem);
}

/* Card slot as flex item */
.ph-flex-card {
  /* Flex item properties */
  flex: 0 1 auto; /* Don't grow, can shrink, auto basis */
  min-width: 44px; /* Minimum touch target */
  min-height: 44px; /* Minimum touch target */
  
  /* Static positioning - no absolute! */
  position: relative;
  
  /* Dynamic card dimensions with min/max constraints */
  --dynamic-card-width: calc(var(--card-width) * var(--ph-card-scale));
  --dynamic-card-height: calc(var(--card-height) * var(--ph-card-scale));
  
  width: var(--dynamic-card-width);
  height: var(--dynamic-card-height);
  
  /* Transitions */
  transition: all var(--card-transition);
  
  /* Z-index management - increment for each card */
  z-index: calc(var(--z-card-base) + var(--card-index, 0));
}

/* Ensure card content is responsive */
.ph-flex-card > * {
  max-width: 100%;
  height: auto;
  object-fit: contain;
}

/* SOUTH PLAYER - Arc effect with transforms only */
.ph-flex-wrapper[data-position="south"] .ph-flex-container {
  /* Dynamic width based on viewport */
  width: min(95vw, 800px);
  max-width: 100%;
  padding: clamp(1rem, 3vw, 3rem) clamp(0.5rem, 2vw, 2rem);

  /* Perspective for 3D arc effect */
  perspective: 1000px;

  /* Allow shrinking if needed */
  min-width: 0;
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card {
  /* Each card gets transform for arc position */
  transform-origin: center bottom;
}

/* Arc transforms for each card position */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) {
  transform:
    rotateZ(var(--ph-arc-rotation-base))
    translateY(var(--ph-arc-lift-max));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(2) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step)))
    translateY(var(--ph-arc-lift-mid));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(3) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 2))
    translateY(var(--ph-arc-lift-low));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(4) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 3))
    translateY(var(--ph-arc-lift-min));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(5) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 4))
    translateY(var(--ph-arc-lift-min));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(6) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 5))
    translateY(var(--ph-arc-lift-low));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(7) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 6))
    translateY(var(--ph-arc-lift-mid));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) {
  transform:
    rotateZ(calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 7))
    translateY(var(--ph-arc-lift-max));
}

/* Hover states */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:hover {
  z-index: var(--z-card-hover);
  transform: 
    rotateZ(var(--hover-rotation, 0deg))
    translateY(calc(var(--hover-y, 0px) - 20px))
    scale(1.05);
}

/* Set hover rotation values */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1):hover { --hover-rotation: var(--ph-arc-rotation-base); --hover-y: var(--ph-arc-lift-max); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(2):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step)); --hover-y: var(--ph-arc-lift-mid); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(3):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 2); --hover-y: var(--ph-arc-lift-low); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(4):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 3); --hover-y: var(--ph-arc-lift-min); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(5):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 4); --hover-y: var(--ph-arc-lift-min); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(6):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 5); --hover-y: var(--ph-arc-lift-low); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(7):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 6); --hover-y: var(--ph-arc-lift-mid); }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8):hover { --hover-rotation: calc(var(--ph-arc-rotation-base) + var(--ph-arc-rotation-step) * 7); --hover-y: var(--ph-arc-lift-max); }

/* NORTH PLAYER - Compact horizontal layout */
.ph-flex-wrapper[data-position="north"] .ph-flex-container {
  gap: 0; /* Remove gap for overlapping */
  max-width: clamp(300px, 70vw, 600px); /* Increased max width for 50% overlap */
  justify-content: center;
}

.ph-flex-wrapper[data-position="north"] .ph-flex-card {
  flex: 0 0 auto;
  width: calc(var(--card-width) * var(--ph-card-scale) * 0.7);

  /* Negative margin for overlap - using compact ratio */
  margin-right: calc(var(--card-width) * var(--ph-card-scale) * calc(-1 * var(--card-overlap-compact)));
}

/* Last card shouldn't have negative margin */
.ph-flex-wrapper[data-position="north"] .ph-flex-card:last-child {
  margin-right: 0;
}

/* Dynamic overlap based on card count for North player */
.ph-flex-wrapper[data-position="north"][data-card-count="8"] .ph-flex-card {
  margin-right: calc(var(--card-width) * var(--ph-card-scale) * calc(-1 * var(--card-overlap-tight)));
}

/* EAST/WEST PLAYERS - Vertical flex with rotation */
.ph-flex-wrapper[data-position="east"] .ph-flex-container,
.ph-flex-wrapper[data-position="west"] .ph-flex-container {
  flex-direction: column;
  gap: 0; /* Remove gap to allow overlapping */
  max-height: clamp(400px, 80vh, 700px); /* Increased for 50% overlap */
  justify-content: center;
}

.ph-flex-wrapper[data-position="east"] .ph-flex-card,
.ph-flex-wrapper[data-position="west"] .ph-flex-card {
  flex: 0 0 auto;
  width: calc(var(--card-width) * var(--ph-card-scale) * 0.5);
  height: calc(var(--card-height) * var(--ph-card-scale) * 0.5);

  /* Negative margin to create overlap - using compact ratio */
  margin-bottom: calc(var(--card-height) * var(--ph-card-scale) * calc(-1 * var(--card-overlap-compact)));
}

/* Last card shouldn't have negative margin */
.ph-flex-wrapper[data-position="east"] .ph-flex-card:last-child,
.ph-flex-wrapper[data-position="west"] .ph-flex-card:last-child {
  margin-bottom: 0;
}

/* Dynamic overlap based on card count for East/West players */
.ph-flex-wrapper[data-position="east"][data-card-count="8"] .ph-flex-card,
.ph-flex-wrapper[data-position="west"][data-card-count="8"] .ph-flex-card {
  margin-bottom: calc(var(--card-height) * var(--ph-card-scale) * calc(-1 * var(--card-overlap-tight)));
}

.ph-flex-wrapper[data-position="east"] .ph-flex-card {
  transform: rotate(90deg);
}

.ph-flex-wrapper[data-position="west"] .ph-flex-card {
  transform: rotate(-90deg);
}


/* Container responsive properties using clamp() */
.ph-flex-container {
  gap: clamp(0px, 0.5vw, var(--card-gap));
  padding: clamp(0.5rem, 1vw, 1rem);
}

/* Responsive card overlap using clamp() - fixed at 50% */
.ph-flex-wrapper[data-position="north"] .ph-flex-card {
  margin-right: calc(var(--dynamic-card-width) * -0.5);
}

.ph-flex-wrapper[data-position="east"] .ph-flex-card,
.ph-flex-wrapper[data-position="west"] .ph-flex-card {
  margin-bottom: calc(var(--dynamic-card-height) * -0.5);
}

/* Responsive arc effect for south player using clamp() */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) {
  transform: rotateZ(clamp(-12deg, -20deg + 8deg * (100vw - 320px) / 800, -20deg)) 
             translateY(clamp(20px, 15px + 10px * (100vw - 320px) / 800, 30px));
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) {
  transform: rotateZ(clamp(12deg, 20deg - 8deg * (100vw - 320px) / 800, 20deg)) 
             translateY(clamp(20px, 15px + 10px * (100vw - 320px) / 800, 30px));
}

/* Structural changes still need media queries */
@media (width <= 640px) {
  /* Reduce arc effect on mobile - keep these as discrete changes */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) { transform: rotateZ(-12deg) translateY(20px); }
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) { transform: rotateZ(12deg) translateY(20px); }
}

/* Handle overflow scenarios - EXTREME FALLBACK */
@media (width <= 480px) {
  /* For very small screens, use scroll for all positions */
  .ph-flex-wrapper .ph-flex-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    max-width: 100%;
    max-height: 100%;
  }
  
  /* South player horizontal scroll */
  .ph-flex-wrapper[data-position="south"] .ph-flex-container {
    overflow: auto visible;
  }
  
  /* East/West vertical scroll */
  .ph-flex-wrapper[data-position="east"] .ph-flex-container,
  .ph-flex-wrapper[data-position="west"] .ph-flex-container {
    overflow: visible auto;
    max-height: 80vh;
  }
  
  /* Add scroll padding */
  .ph-flex-container::before,
  .ph-flex-container::after {
    content: '';
    flex: 0 0 0.5rem;
  }
}

/* Ensure selected state is visible */
.ph-flex-card.ph-selected {
  z-index: var(--z-card-selected);
  transform: scale(1.05);
  box-shadow: 0 0 var(--shadow-md) rgb(59 130 246 / 80%);
}

/* Keyboard selection state */
.ph-flex-card.ph-keyboard-selected {
  z-index: calc(var(--z-card-selected) - 5);
  transform: translateY(-12px) scale(1.02);
}

/* For south position, preserve arc rotation */
.ph-flex-wrapper[data-position="south"] .ph-flex-card.ph-keyboard-selected {
  transform: rotateZ(var(--hover-rotation, 0deg)) translateY(calc(var(--hover-y, 0px) - 25px)) scale(1.02);
}

/* Animation states */
.ph-flex-wrapper[data-hovering="true"] .ph-flex-card {
  transition: all 0.15s ease-out;
}

/* Prevent layout shift during animations */
.ph-flex-container {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}


/* Container query support for dynamic card sizing */
@container (max-width: 400px) {
  .ph-flex-card {
    --dynamic-card-width: clamp(
      calc(var(--card-width) * 0.75),
      10vw,
      var(--card-width)
    );
    --dynamic-card-height: clamp(
      calc(var(--card-height) * 0.75),
      14vw,
      var(--card-height)
    );
  }
}

/* More aggressive mobile overlap */
@media (width <= 400px) {
  /* South player - more overlap for 8 cards */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card {
    margin-right: calc(var(--dynamic-card-width) * -0.4);
  }
  
  /* Reduce arc effect on very small screens */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) {
    transform: rotateZ(-10deg) translateY(15px);
  }

  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) {
    transform: rotateZ(10deg) translateY(15px);
  }
  
  /* North player - extreme overlap */
  .ph-flex-wrapper[data-position="north"] .ph-flex-card {
    margin-right: calc(var(--dynamic-card-width) * -0.6);
  }
}

/* Minimum touch targets already defined in main .ph-flex-card rule above */
