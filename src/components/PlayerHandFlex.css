/* PlayerHand Flexbox Layout - Modern responsive approach */

/* 
 * Flexbox-based card layout system
 * Eliminates absolute positioning for better responsiveness
 * Prevents clipping issues with proper flex item management
 */

/* Variables from tokens.css */

/* Base wrapper */
.ph-flex-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
  z-index: inherit;
  isolation: isolate;
  padding: 8px; /* Add small padding to prevent edge clipping */
}

/* Flex container for cards */
.ph-flex-container {
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap; /* Keep cards in single row */
  gap: var(--ph-card-gap, 8px);
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  max-width: 100%;
  overflow: visible;
  padding: var(--ph-container-padding, 1rem);
}

/* Card slot as flex item */
.ph-flex-card {
  /* Flex item properties */
  flex: 0 1 auto; /* Don't grow, can shrink, auto basis */
  min-width: 0; /* Allow shrinking below content size */
  min-height: 0; /* Allow shrinking below content size */
  
  /* Static positioning - no absolute! */
  position: relative;
  
  /* Dynamic card dimensions with min/max constraints */
  --dynamic-card-width: clamp(
    60px,  /* minimum */
    calc(var(--ph-card-width) * var(--ph-card-scale)), /* preferred */
    120px  /* maximum */
  );
  --dynamic-card-height: clamp(
    84px,  /* minimum */
    calc(var(--ph-card-height) * var(--ph-card-scale)), /* preferred */
    168px  /* maximum */
  );
  
  width: var(--dynamic-card-width);
  height: var(--dynamic-card-height);
  
  /* Transitions */
  transition: all var(--ph-transition);
  
  /* Z-index management - increment for each card */
  z-index: calc(var(--card-index, 0) + 1);
}

/* Ensure card content is responsive */
.ph-flex-card > * {
  max-width: 100%;
  height: auto;
  object-fit: contain;
}

/* SOUTH PLAYER - Arc effect with transforms only */
.ph-flex-wrapper[data-position="south"] .ph-flex-container {
  /* Dynamic width based on viewport */
  width: min(95vw, 800px);
  max-width: 100%;
  padding: clamp(1rem, 3vw, 3rem) clamp(0.5rem, 2vw, 2rem);
  /* Perspective for 3D arc effect */
  perspective: 1000px;
  /* Allow shrinking if needed */
  min-width: 0;
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card {
  /* Each card gets transform for arc position */
  transform-origin: center bottom;
}

/* Arc transforms for each card position */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) {
  transform: 
    rotateZ(-17.5deg)
    translateY(35px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(2) {
  transform: 
    rotateZ(-12.5deg)
    translateY(20px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(3) {
  transform: 
    rotateZ(-7.5deg)
    translateY(10px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(4) {
  transform: 
    rotateZ(-2.5deg)
    translateY(5px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(5) {
  transform: 
    rotateZ(2.5deg)
    translateY(5px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(6) {
  transform: 
    rotateZ(7.5deg)
    translateY(10px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(7) {
  transform: 
    rotateZ(12.5deg)
    translateY(20px);
}

.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) {
  transform: 
    rotateZ(17.5deg)
    translateY(35px);
}

/* Hover states */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:hover {
  z-index: var(--z-card-hover, 50);
  transform: 
    rotateZ(var(--hover-rotation, 0deg))
    translateY(calc(var(--hover-y, 0px) - 20px))
    scale(1.05);
}

/* Set hover rotation values */
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1):hover { --hover-rotation: -17.5deg; --hover-y: 35px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(2):hover { --hover-rotation: -12.5deg; --hover-y: 20px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(3):hover { --hover-rotation: -7.5deg; --hover-y: 10px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(4):hover { --hover-rotation: -2.5deg; --hover-y: 5px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(5):hover { --hover-rotation: 2.5deg; --hover-y: 5px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(6):hover { --hover-rotation: 7.5deg; --hover-y: 10px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(7):hover { --hover-rotation: 12.5deg; --hover-y: 20px; }
.ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8):hover { --hover-rotation: 17.5deg; --hover-y: 35px; }

/* NORTH PLAYER - Compact horizontal layout */
.ph-flex-wrapper[data-position="north"] .ph-flex-container {
  gap: 0; /* Remove gap for overlapping */
  max-width: min(90%, 400px); /* Reduce max width */
  justify-content: center;
}

.ph-flex-wrapper[data-position="north"] .ph-flex-card {
  flex: 0 0 auto;
  width: calc(var(--ph-card-width) * var(--ph-card-scale) * 0.7);
  /* Negative margin for overlap */
  margin-right: calc(var(--ph-card-width) * var(--ph-card-scale) * -0.3);
}

/* Last card shouldn't have negative margin */
.ph-flex-wrapper[data-position="north"] .ph-flex-card:last-child {
  margin-right: 0;
}

/* EAST/WEST PLAYERS - Vertical flex with rotation */
.ph-flex-wrapper[data-position="east"] .ph-flex-container,
.ph-flex-wrapper[data-position="west"] .ph-flex-container {
  flex-direction: column;
  gap: 0; /* Remove gap to allow overlapping */
  max-height: min(90%, 500px);
  justify-content: center;
}

.ph-flex-wrapper[data-position="east"] .ph-flex-card,
.ph-flex-wrapper[data-position="west"] .ph-flex-card {
  flex: 0 0 auto;
  width: calc(var(--ph-card-width) * var(--ph-card-scale) * 0.5);
  height: calc(var(--ph-card-height) * var(--ph-card-scale) * 0.5);
  /* Negative margin to create overlap - adjusted for better visibility */
  margin-bottom: calc(var(--ph-card-height) * var(--ph-card-scale) * -0.35);
}

/* Last card shouldn't have negative margin */
.ph-flex-wrapper[data-position="east"] .ph-flex-card:last-child,
.ph-flex-wrapper[data-position="west"] .ph-flex-card:last-child {
  margin-bottom: 0;
}

.ph-flex-wrapper[data-position="east"] .ph-flex-card {
  transform: rotate(90deg);
}

.ph-flex-wrapper[data-position="west"] .ph-flex-card {
  transform: rotate(-90deg);
}

/* Card size controls from Settings */
.ph-flex-wrapper {
  --ph-card-scale: var(--card-size-scale, 1.0);
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .ph-flex-container {
    gap: 0;
    padding: 0.5rem;
  }
  
  .ph-flex-wrapper {
    --ph-card-scale: 0.5;
  }
  
  /* More aggressive overlap on mobile */
  .ph-flex-wrapper[data-position="north"] .ph-flex-card {
    margin-right: calc(var(--dynamic-card-width) * -0.5);
  }
  
  .ph-flex-wrapper[data-position="east"] .ph-flex-card,
  .ph-flex-wrapper[data-position="west"] .ph-flex-card {
    margin-bottom: calc(var(--dynamic-card-height) * -0.5);
  }
  
  /* Reduce arc effect on mobile */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) { transform: rotateZ(-12deg) translateY(20px); }
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) { transform: rotateZ(12deg) translateY(20px); }
}

@media (min-width: 641px) and (max-width: 768px) {
  .ph-flex-wrapper {
    --ph-card-scale: 0.7;
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  .ph-flex-wrapper {
    --ph-card-scale: 0.85;
  }
}

@media (min-width: 1025px) and (max-width: 1440px) {
  .ph-flex-wrapper {
    --ph-card-scale: 0.95;
  }
}

/* Handle overflow scenarios - EXTREME FALLBACK */
@media (max-width: 480px) {
  /* For very small screens, use scroll for all positions */
  .ph-flex-wrapper .ph-flex-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    max-width: 100%;
    max-height: 100%;
  }
  
  /* South player horizontal scroll */
  .ph-flex-wrapper[data-position="south"] .ph-flex-container {
    overflow-x: auto;
    overflow-y: visible;
  }
  
  /* East/West vertical scroll */
  .ph-flex-wrapper[data-position="east"] .ph-flex-container,
  .ph-flex-wrapper[data-position="west"] .ph-flex-container {
    overflow-y: auto;
    overflow-x: visible;
    max-height: 80vh;
  }
  
  /* Add scroll padding */
  .ph-flex-container::before,
  .ph-flex-container::after {
    content: '';
    flex: 0 0 0.5rem;
  }
}

/* Ensure selected state is visible */
.ph-flex-card.ph-selected {
  z-index: var(--z-card-selected, 40);
  transform: scale(1.05) !important;
  box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
}

/* Animation states */
.ph-flex-wrapper[data-hovering="true"] .ph-flex-card {
  transition: all 0.15s ease-out;
}

/* Prevent layout shift during animations */
.ph-flex-container {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Custom properties for fine-tuning */
:root {
  --ph-card-gap: 8px;
  --ph-container-padding: 1rem;
}

/* Container query support for dynamic card sizing */
@container (max-width: 400px) {
  .ph-flex-card {
    --dynamic-card-width: clamp(45px, 10vw, 60px);
    --dynamic-card-height: clamp(63px, 14vw, 84px);
  }
}

/* More aggressive mobile overlap */
@media (max-width: 400px) {
  /* South player - more overlap for 8 cards */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card {
    margin-right: calc(var(--dynamic-card-width) * -0.4);
  }
  
  /* Reduce arc effect on very small screens */
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(1) {
    transform: rotateZ(-10deg) translateY(15px);
  }
  .ph-flex-wrapper[data-position="south"] .ph-flex-card:nth-child(8) {
    transform: rotateZ(10deg) translateY(15px);
  }
  
  /* North player - extreme overlap */
  .ph-flex-wrapper[data-position="north"] .ph-flex-card {
    margin-right: calc(var(--dynamic-card-width) * -0.6);
  }
}

/* Ensure minimum touch targets */
.ph-flex-card {
  min-width: 44px; /* Minimum touch target */
  min-height: 44px;
}